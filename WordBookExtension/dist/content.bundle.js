(()=>{"use strict";const e={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}for(var i=[],d=0;d<256;++d)i.push((d+256).toString(16).slice(1));const s=function(t,n,d){if(e.randomUUID&&!n&&!t)return e.randomUUID();var s=(t=t||{}).random||(t.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n){d=d||0;for(var r=0;r<16;++r)n[d+r]=s[r];return n}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(s)};function r(e,t){if(e.nodeType===Node.TEXT_NODE){let n=0,o=[],i=[],d=[];for(;;){console.log(e.textContent);let s=t.map((t=>e.textContent.indexOf(t.name,n)));if(console.log(`posList: ${s}`),s.every((e=>e<0)))break;let r=Array.from(s.keys());r.sort(((e,t)=>s[e]<0?1:s[t]<0?-1:s[e]-s[t]));let l=t[r[0]];d.push(r[0]),o.push(s[r[0]]),i.push(s[r[0]]+l.name.length),n=s[r[0]]+l.name.length}let s=e.parentNode;console.log(`highlightWordIndices: ${d}`),console.log(`beforeIndices: ${o}`),console.log(`afterIndices: ${i}`),0!=d.length&&(d.forEach(((n,d)=>{let r=Object.assign(document.createElement("span"),{className:"highlight",textContent:t[n].name,onmouseenter:e=>{let o=Object.assign(document.createElement("div"),{className:"t div_word",textContent:null,id:"word_floating",style:`position: absolute; top: ${e.pageY}px; left: ${e.pageX}px; z-index: 1000;`}),i=Object.assign(document.createElement("div"),{className:"t div_wordName",textContent:t[n].name});o.appendChild(i);let d=Object.assign(document.createElement("div"),{className:"t div_wordData",textContent:t[n].desc});o.appendChild(d);let s=Object.assign(document.createElement("button"),{className:"t div_debugInfo",textContent:"debug info...",isClosed:!0});s.addEventListener("click",(function(){let e=s.isClosed;s.textContent=e?JSON.stringify(t[n]):"debug info...",s.isClosed=!e})),o.appendChild(s),document.body.appendChild(o)},onmouseleave:e=>{document.getElementById("word_floating").remove()}}),l=e.textContent.slice(d<=0?0:i[d-1],o[d]),a=e.textContent.slice(i[d],d>=e.textContent.length-1?e.textContent.length-1:o[d+1]);s.insertBefore(document.createTextNode(l),e),s.insertBefore(r,e),s.insertBefore(document.createTextNode(a),e)})),s.removeChild(e))}else for(let n=0;n<e.childNodes.length;n++)"highlight"!==e.childNodes[n].className&&r(e.childNodes[n],t)}document.addEventListener("click",(function(e){let t=window.getSelection().toString().trim(),n=document.getElementById("floatingButton");if(n&&n.remove(),console.log(`select: ${t}`),t.length>0){console.log("button created.");let n=Object.assign(document.createElement("button"),{id:"floatingButton",textContent:"save",style:`position: absolute; top: ${e.pageY}px; left: ${e.pageX}px; z-index: 1000;`});n.addEventListener("mousedown",(function(){let e={uuid:s(),name:t,desc:"my name is "+t+".",timestamp:(new Date).toISOString()},o="new";chrome.storage.local.get({wordList:[],categoryList:{}},(function(t){let n=t.wordList,i=t.categoryList;0==i.hasOwnProperty(o)&&(i[o]=[]),i[o].push(e.uuid),n.push(e),chrome.storage.local.set({wordList:n,categoryList:i},(function(){console.log(`Saved: ${JSON.stringify(e)} into ${o}.`)}))})),n.remove()})),document.body.appendChild(n)}})),window.addEventListener("scroll",(function(){})),window.onload=function(){chrome.storage.local.get({wordList:[]},(function(e){r(document.body,e.wordList)}))}})();