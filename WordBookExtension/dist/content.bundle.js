(()=>{"use strict";const e={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}for(var d=[],i=0;i<256;++i)d.push((i+256).toString(16).slice(1));const s=function(t,n,i){if(e.randomUUID&&!n&&!t)return e.randomUUID();var s=(t=t||{}).random||(t.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n){i=i||0;for(var a=0;a<16;++a)n[i+a]=s[a];return n}return function(e,t=0){return(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase()}(s)},a=["floatingButton","div_save","word_floating"];function r(e,t){if(e.nodeType===Node.TEXT_NODE){let n=0,o=[],d=[],i=[];for(;;){console.log(e.textContent);let s=t.map((t=>e.textContent.indexOf(t.name,n)));if(console.log(`posList: ${s}`),s.every((e=>e<0)))break;let a=Array.from(s.keys());a.sort(((e,t)=>s[e]<0?1:s[t]<0?-1:s[e]-s[t]));let r=t[a[0]];i.push(a[0]),o.push(s[a[0]]),d.push(s[a[0]]+r.name.length),n=s[a[0]]+r.name.length}let s=e.parentNode;console.log(`highlightWordIndices: ${i}`),console.log(`beforeIndices: ${o}`),console.log(`afterIndices: ${d}`),0!=i.length&&(i.forEach(((n,i)=>{let a=Object.assign(document.createElement("span"),{className:"highlight",textContent:t[n].name,onmouseenter:e=>{let o=document.getElementById("word_floating");o&&o.remove();let d=Object.assign(document.createElement("div"),{className:"t div_word",textContent:null,id:"word_floating",style:`position: absolute; top: ${e.pageY}px; left: ${e.pageX}px; z-index: 1000;`}),i=(Object.assign(document.createElement("div"),{className:"t div_wordName",textContent:t[n].name}),Object.assign(document.createElement("div"),{className:"t div_wordData",textContent:t[n].desc}));d.appendChild(i);let s=Object.assign(document.createElement("button"),{className:"t div_debugInfo",textContent:"debug info...",isClosed:!0});s.addEventListener("click",(function(){let e=s.isClosed;s.textContent=e?JSON.stringify(t[n]):"debug info...",s.isClosed=!e})),d.appendChild(s),document.body.appendChild(d)}}),r=e.textContent.slice(i<=0?0:d[i-1],o[i]),c=e.textContent.slice(d[i],i>=e.textContent.length-1?e.textContent.length-1:o[i+1]);s.insertBefore(document.createTextNode(r),e),s.insertBefore(a,e),s.insertBefore(document.createTextNode(c),e)})),s.removeChild(e))}else for(let n=0;n<e.childNodes.length;n++)"highlight"!==e.childNodes[n].className&&r(e.childNodes[n],t)}document.addEventListener("click",(function(e){let t=window.getSelection().toString().trim();if(a.forEach((t=>{let n=document.getElementById(t);n&&!n.contains(e.target)&&n.remove()})),console.log(`select: ${t}`),t.length>0){console.log("button created.");let n=Object.assign(document.createElement("button"),{id:"floatingButton",textContent:"save",style:`position: absolute; top: ${e.pageY}px; left: ${e.pageX}px; z-index: 1000;`});n.addEventListener("mousedown",(function(){console.log("add new word");let o=Object.assign(document.createElement("div"),{id:"div_save",className:"t div_category",textContent:"save",style:`position: absolute; top: ${e.pageY}px; left: ${e.pageX}px; z-index: 1000;`}),d="my name is "+t+".",i=Object.assign(document.createElement("div"),{className:"t div_wordData",textContent:d});o.appendChild(i);let a=Object.assign(document.createElement("button"),{className:"t",textContent:"add"});a.addEventListener("click",(function(){let e="new";chrome.storage.local.get({wordList:[],categoryList:{}},(function(n){let o=n.wordList,i=n.categoryList,a={uuid:s(),name:t,desc:d,timestamp:(new Date).toISOString()};0==i.hasOwnProperty(e)&&(i[e]=[]),i[e].push(a.uuid),o.push(a),chrome.storage.local.set({wordList:o,categoryList:i},(function(){console.log(`Saved: ${JSON.stringify(a)} into ${e}.`)}))})),o.remove()})),o.appendChild(a),n.remove(),document.body.appendChild(o)})),document.body.appendChild(n)}})),document.addEventListener("click",(function(e){})),window.addEventListener("scroll",(function(){})),window.onload=function(){chrome.storage.local.get({wordList:[]},(function(e){r(document.body,e.wordList)}))},chrome.runtime.onMessage.addListener(((e,t,n)=>{"yourLocalStorageKeyChanged"===e.message&&chrome.storage.local.get({wordList:[]},(function(e){r(document.body,e.wordList)}))}))})();